<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- â˜… ìºì‹œ ë°©ì§€ ë©”íƒ€ íƒœê·¸ ì¶”ê°€ -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">


<title>í”„ë¦°ìŠ¤ ì—°ì°¨íœ´ê°€ ê´€ë¦¬ 2025~2026</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“‹</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI','Apple SD Gothic Neo','Malgun Gothic',sans-serif;background:#f0f2f5;color:#1a1a2e;line-height:1.6}
.header{background:linear-gradient(135deg,#4a00e0,#8e2de2);color:#fff;padding:14px 24px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(74,0,224,.3)}
.header h1{font-size:1.25rem;display:flex;align-items:center;gap:8px}
.header-right{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.header-date{background:rgba(255,255,255,.18);padding:6px 14px;border-radius:20px;font-size:.85rem}
.btn{padding:8px 18px;border:none;border-radius:8px;cursor:pointer;font-size:.88rem;font-weight:600;transition:all .2s}
.btn-fire{background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:#fff}
.btn-fire:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(238,90,36,.4)}
.btn-admin{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3)}
.btn-admin:hover{background:rgba(255,255,255,.35)}
.btn-sync{background:rgba(255,255,255,.15);color:#fff;font-size:.78rem;border:1px solid rgba(255,255,255,.25)}
.tabs{display:flex;gap:0;background:#fff;border-bottom:2px solid #e8e8e8;padding:0 24px}
.tab{padding:14px 24px;cursor:pointer;font-weight:600;color:#888;border-bottom:3px solid transparent;transition:all .2s}
.tab:hover{color:#4a00e0}
.tab.active{color:#4a00e0;border-bottom-color:#4a00e0}
.content{max-width:1200px;margin:0 auto;padding:20px}
.section{display:none}
.section.active{display:block}
.cal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.cal-header h2{font-size:1.3rem;color:#1a1a2e}
.cal-nav{display:flex;align-items:center;gap:12px}
.cal-nav button{width:36px;height:36px;border-radius:50%;border:1px solid #ddd;background:#fff;cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;transition:all .2s}
.cal-nav button:hover{background:#4a00e0;color:#fff;border-color:#4a00e0}
.cal-legend{display:flex;gap:14px;font-size:.78rem;color:#666;flex-wrap:wrap}
.cal-legend span{display:flex;align-items:center;gap:4px}
.cal-legend i{width:10px;height:10px;border-radius:3px;display:inline-block}
.calendar-table{width:100%;border-collapse:collapse;table-layout:fixed;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.06)}
.calendar-table th{padding:12px 4px;font-size:.82rem;font-weight:700;text-align:center;background:#f8f9fa;color:#555;border-bottom:2px solid #e8e8e8}
.calendar-table th:first-child{color:#e74c3c}
.calendar-table th:last-child{color:#3498db}
.calendar-table td{height:100px;vertical-align:top;padding:4px;border:1px solid #f0f0f0;position:relative;transition:background .15s}
.calendar-table td:hover{background:#fafafe}
.cal-date{font-size:.82rem;font-weight:700;padding:2px 6px;display:inline-block;border-radius:50%;min-width:24px;text-align:center}
.cal-date.today{background:#4a00e0;color:#fff}
.cal-date.sunday{color:#e74c3c}
.cal-date.saturday{color:#3498db}
.cal-date.holiday{color:#e74c3c;font-weight:800}
td.holiday-cell{background:#fff5f5}
.cal-holiday-name{font-size:.65rem;color:#e74c3c;font-weight:700;display:block;margin-top:1px;line-height:1.2;letter-spacing:-.3px}
.cal-event{font-size:.68rem;padding:2px 5px;margin-top:2px;border-radius:4px;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:1.4;cursor:default}
.cal-event.type-ì—°ì°¨{background:#4a00e0}
.cal-event.type-ë°˜ì°¨{background:#f39c12}
.cal-event.type-ë°˜ë°˜ì°¨{background:#27ae60}
.emp-section{margin-top:28px}
.emp-section h3{font-size:1.1rem;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.emp-table-wrap{overflow-x:auto;background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.06)}
.emp-table{width:100%;border-collapse:collapse;min-width:600px}
.emp-table th{padding:14px 12px;font-size:.8rem;font-weight:700;color:#666;text-align:center;background:#f8f9fa;border-bottom:2px solid #e8e8e8;white-space:nowrap}
.emp-table td{padding:12px;text-align:center;border-bottom:1px solid #f0f0f0;font-size:.88rem}
.emp-table tr:hover{background:#fafafe}
.emp-name-cell{display:flex;align-items:center;gap:10px;cursor:pointer;justify-content:flex-start;padding-left:16px}
.emp-avatar{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:.82rem;flex-shrink:0}
.emp-name-info{text-align:left}
.emp-name-info .name{font-weight:700;color:#1a1a2e;font-size:.9rem}
.emp-name-info .title{font-size:.73rem;color:#888}
.gauge-wrap{display:flex;align-items:center;gap:8px}
.gauge-bar{flex:1;height:10px;background:#eee;border-radius:5px;overflow:hidden;min-width:80px}
.gauge-fill{height:100%;border-radius:5px;transition:width .6s ease}
.gauge-text{font-size:.75rem;color:#666;white-space:nowrap;min-width:35px}
.remaining-badge{font-weight:800;padding:4px 10px;border-radius:12px;font-size:.85rem}
.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:16px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2)}
.modal-sm{max-width:520px}
.modal-md{max-width:650px}
.modal-lg{max-width:800px}
.modal-header{padding:20px 24px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
.modal-header h3{font-size:1.15rem;display:flex;align-items:center;gap:8px}
.modal-close{width:32px;height:32px;border-radius:50%;border:none;background:#f0f0f0;cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;transition:all .2s}
.modal-close:hover{background:#e74c3c;color:#fff}
.modal-body{padding:24px}
.modal-footer{padding:16px 24px;border-top:1px solid #eee;display:flex;justify-content:flex-end;gap:8px}
.step-indicator{display:flex;gap:0;margin-bottom:20px}
.step{flex:1;text-align:center;padding:10px 4px;font-size:.78rem;font-weight:600;color:#aaa;background:#f8f9fa;position:relative;transition:all .3s}
.step.active{background:#4a00e0;color:#fff}
.step.done{background:#27ae60;color:#fff}
.step:first-child{border-radius:8px 0 0 8px}
.step:last-child{border-radius:0 8px 8px 0}
.notice-box{background:linear-gradient(135deg,#f0ebff,#e8f5e9);border:1px solid #d4c5f9;border-radius:10px;padding:14px 18px;margin-bottom:20px;display:flex;align-items:flex-start;gap:10px;font-size:.84rem;color:#333;line-height:1.6}
.notice-box .notice-icon{font-size:1.3rem;flex-shrink:0;margin-top:1px}
.notice-box .notice-text{flex:1}
.notice-box .notice-text b{color:#4a00e0}
.emp-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.emp-card{padding:14px 10px;border:2px solid #e8e8e8;border-radius:12px;text-align:center;cursor:pointer;transition:all .2s}
.emp-card:hover{border-color:#4a00e0;background:#f8f6ff}
.emp-card.selected{border-color:#4a00e0;background:#f0ebff}
.emp-card .avatar{width:42px;height:42px;border-radius:50%;margin:0 auto 6px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:.9rem}
.emp-card .ename{font-weight:700;font-size:.9rem}
.emp-card .etitle{font-size:.73rem;color:#888}
.type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.type-card{padding:18px 10px;border:2px solid #e8e8e8;border-radius:12px;text-align:center;cursor:pointer;transition:all .2s}
.type-card:hover{border-color:#4a00e0}
.type-card.selected{border-color:#4a00e0;background:#f0ebff}
.type-card .ticon{font-size:1.8rem;margin-bottom:4px}
.type-card .tname{font-weight:700;font-size:.95rem}
.type-card .tdesc{font-size:.72rem;color:#888;margin-top:2px}
.half-options{margin-top:12px;display:flex;gap:8px}
.half-options .btn{flex:1;padding:10px;border:2px solid #e8e8e8;background:#fff;color:#333;border-radius:8px}
.half-options .btn.selected{border-color:#4a00e0;background:#f0ebff;color:#4a00e0}
.quarter-options{margin-top:12px;display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.quarter-options .btn{padding:10px;border:2px solid #e8e8e8;background:#fff;color:#333;border-radius:8px;font-size:.82rem}
.quarter-options .btn.selected{border-color:#4a00e0;background:#f0ebff;color:#4a00e0}
.date-input-area{margin-top:12px}
.selected-dates{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;min-height:32px}
.date-tag{background:#f0ebff;color:#4a00e0;padding:4px 12px;border-radius:16px;font-size:.82rem;font-weight:600;display:flex;align-items:center;gap:4px}
.date-tag .remove{cursor:pointer;font-size:.9rem;margin-left:2px}
.confirm-box{background:#f8f9fa;border-radius:12px;padding:20px;margin-top:16px}
.confirm-row{display:flex;justify-content:space-between;padding:6px 0;font-size:.9rem}
.confirm-row .label{color:#888}
.confirm-row .value{font-weight:700}
.copy-msg-box{background:#f0ebff;border-radius:8px;padding:14px;margin-top:12px;font-size:.85rem;color:#4a00e0;line-height:1.5}
.detail-top{display:flex;align-items:center;gap:16px;margin-bottom:20px}
.detail-avatar{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:1.3rem}
.detail-info h4{font-size:1.15rem;font-weight:700}
.detail-info p{font-size:.85rem;color:#888}
.detail-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px}
.detail-stat{background:#f8f9fa;border-radius:10px;padding:14px;text-align:center}
.detail-stat .ds-label{font-size:.72rem;color:#888;margin-bottom:4px}
.detail-stat .ds-value{font-size:1.2rem;font-weight:800}
.detail-gauge{margin-bottom:20px}
.detail-gauge .gauge-bar{height:14px}
.history-list{max-height:260px;overflow-y:auto}
.history-item{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #f0f0f0;font-size:.85rem}
.history-item:last-child{border-bottom:none}
.history-type{padding:3px 10px;border-radius:10px;color:#fff;font-size:.75rem;font-weight:600}
.history-cancel-btn{padding:4px 10px;border-radius:8px;border:1px solid #e74c3c;background:#fff;color:#e74c3c;font-size:.72rem;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.history-cancel-btn:hover{background:#e74c3c;color:#fff}
.history-cancel-btn:disabled{border-color:#ccc;color:#ccc;background:#f8f8f8;cursor:not-allowed}
.history-cancel-btn:disabled:hover{background:#f8f8f8;color:#ccc}
.admin-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:20px}
.admin-emp-card{background:#fff;border-radius:12px;padding:16px;border:1px solid #e8e8e8;transition:all .2s}
.admin-emp-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.08)}
.admin-emp-top{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.admin-emp-top .avatar{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:.85rem}
.admin-emp-top .info .name{font-weight:700;font-size:.95rem}
.admin-emp-top .info .sub{font-size:.75rem;color:#888}
.admin-actions{display:flex;gap:6px;flex-wrap:wrap}
.admin-actions .btn{font-size:.75rem;padding:5px 10px;border-radius:6px}
.btn-outline{border:1px solid #ddd;background:#fff;color:#555}
.btn-outline:hover{border-color:#4a00e0;color:#4a00e0}
.btn-danger{background:#fee;color:#e74c3c;border:1px solid #fcc}
.btn-danger:hover{background:#e74c3c;color:#fff}
.btn-primary{background:#4a00e0;color:#fff}
.btn-primary:hover{background:#3a00b0}
.btn-success{background:#27ae60;color:#fff}
.btn-success:hover{background:#1e8449}
.btn-secondary{background:#f0f0f0;color:#555;border:1px solid #ddd}
.btn-secondary:hover{background:#e0e0e0}
.btn-warning{background:#fff3cd;color:#856404;border:1px solid #ffc107}
.btn-warning:hover{background:#ffc107;color:#333}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:.82rem;font-weight:600;color:#555;margin-bottom:6px}
.form-group input,.form-group select{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:.9rem;transition:border .2s}
.form-group input:focus,.form-group select:focus{outline:none;border-color:#4a00e0}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.policy-card{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:16px}
.policy-card h4{font-size:1rem;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.policy-table{width:100%;border-collapse:collapse}
.policy-table th,.policy-table td{padding:10px 14px;text-align:left;font-size:.85rem;border-bottom:1px solid #f0f0f0}
.policy-table th{background:#f8f9fa;font-weight:600;color:#555}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(20px);background:#333;color:#fff;padding:14px 24px;border-radius:12px;font-size:.88rem;z-index:300;opacity:0;transition:all .3s;display:flex;align-items:center;gap:8px;max-width:500px;text-align:center}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.save-float{position:fixed;bottom:24px;right:24px;z-index:150;display:flex;gap:8px;align-items:center}
.save-float .btn{padding:12px 24px;font-size:.95rem;border-radius:12px;box-shadow:0 4px 16px rgba(74,0,224,.3)}
.save-float .save-status{font-size:.75rem;color:#888;background:#fff;padding:6px 12px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.data-tools{margin-top:20px;padding:16px;background:#fff;border-radius:12px;border:1px solid #e8e8e8}
.data-tools h4{margin-bottom:12px;font-size:.95rem;display:flex;align-items:center;gap:8px}
.data-tools .btn-row{display:flex;gap:8px;flex-wrap:wrap}
.holiday-admin{margin-top:20px;padding:16px;background:#fff;border-radius:12px;border:1px solid #e8e8e8}
.holiday-admin h4{margin-bottom:12px;font-size:.95rem;display:flex;align-items:center;gap:8px}
.holiday-add-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;align-items:flex-end}
.holiday-add-row .form-group{margin-bottom:0;flex:1;min-width:140px}
.holiday-list{max-height:300px;overflow-y:auto}
.holiday-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-bottom:1px solid #f0f0f0;font-size:.85rem}
.holiday-item:hover{background:#fafafe}
.holiday-item .hi-date{font-weight:700;color:#4a00e0;min-width:100px}
.holiday-item .hi-name{flex:1;margin-left:12px}
.holiday-item .hi-type{font-size:.7rem;padding:2px 8px;border-radius:8px;margin-left:8px}
.holiday-item .hi-type.default{background:#f0f0f0;color:#888}
.holiday-item .hi-type.custom{background:#fff5f5;color:#e74c3c}
.holiday-del-btn{padding:3px 8px;border-radius:6px;border:1px solid #e74c3c;background:#fff;color:#e74c3c;font-size:.7rem;cursor:pointer;transition:all .2s}
.holiday-del-btn:hover{background:#e74c3c;color:#fff}
.renew-info{background:#fff8e1;border:1px solid #ffc107;border-radius:8px;padding:12px;margin-top:8px;font-size:.82rem;color:#856404;line-height:1.5}
@media(max-width:768px){
.header{padding:10px 14px}.header h1{font-size:1rem}.content{padding:12px}
.emp-grid{grid-template-columns:repeat(2,1fr)}.type-grid{grid-template-columns:1fr}
.detail-stats{grid-template-columns:repeat(2,1fr)}.calendar-table td{height:80px}
.cal-event{font-size:.6rem;padding:1px 3px}.admin-grid{grid-template-columns:1fr}
.form-row{grid-template-columns:1fr}.holiday-add-row{flex-direction:column}
}
</style>
</head>
<body>

<div class="header">
  <h1>ğŸ“‹ í”„ë¦°ìŠ¤ ì—°ì°¨íœ´ê°€ ê´€ë¦¬ <span style="font-size:.75rem;opacity:.7">2025~2026</span></h1>
  <div class="header-right">
    <span class="header-date" id="todayDisplay"></span>
    <button class="btn btn-sync" onclick="toggleSync()" id="syncBtn">ğŸŸ¢ ì‹¤ì‹œê°„ ë™ê¸°í™”</button>
    <button class="btn btn-admin" onclick="openAdminLogin()">ğŸ”’ ê´€ë¦¬ì</button>
    <button class="btn btn-fire" onclick="openApplyModal()">ğŸ“ ì—°ì°¨ ì‹ ì²­</button>
  </div>
</div>

<div class="tabs">
  <div class="tab active" onclick="switchTab('dashboard')">ğŸ“… ëŒ€ì‹œë³´ë“œ</div>
  <div class="tab" onclick="switchTab('policy')">ğŸ“– ì—°ì°¨ê·œì •</div>
</div>

<div class="content">
  <div class="section active" id="sec-dashboard">
    <div class="cal-header">
      <div class="cal-nav">
        <button onclick="changeMonth(-1)">â—€</button>
        <h2 id="calTitle"></h2>
        <button onclick="changeMonth(1)">â–¶</button>
      </div>
      <div class="cal-legend">
        <span><i style="background:#4a00e0"></i> ì—°ì°¨</span>
        <span><i style="background:#f39c12"></i> ë°˜ì°¨</span>
        <span><i style="background:#27ae60"></i> ë°˜ë°˜ì°¨</span>
        <span><i style="background:#e74c3c"></i> ê³µíœ´ì¼</span>
      </div>
    </div>
    <table class="calendar-table" id="calendarTable"></table>
    <div class="emp-section">
      <h3>ğŸ‘¥ ì§ì›ë³„ ì—°ì°¨ í˜„í™©</h3>
      <div class="emp-table-wrap">
        <table class="emp-table" id="empTable"></table>
      </div>
    </div>
  </div>
  <div class="section" id="sec-policy">
    <div class="policy-card">
      <h4>ğŸ“Œ ì—°ì°¨íœ´ê°€ ë¶€ì—¬ ê¸°ì¤€</h4>
      <table class="policy-table">
        <thead><tr><th>ê·¼ì†ê¸°ê°„</th><th>ë¶€ì—¬ì¼ìˆ˜</th><th>ë¹„ê³ </th></tr></thead>
        <tbody>
          <tr><td>1ë…„ ë¯¸ë§Œ</td><td>ì›” 1ì¼ (ìµœëŒ€ 11ì¼)</td><td>ì…ì‚¬ì¼ ê¸°ì¤€ ë§¤ì›” ë°œìƒ</td></tr>
          <tr><td>1ë…„ ì´ìƒ</td><td>15ì¼</td><td>ì…ì‚¬ 1ì£¼ë…„ ì‹œì  ë¶€ì—¬</td></tr>
          <tr><td>3ë…„ ì´ìƒ</td><td>16ì¼</td><td>2ë…„ë§ˆë‹¤ 1ì¼ ê°€ì‚°</td></tr>
          <tr><td>5ë…„ ì´ìƒ</td><td>17ì¼</td><td>ìµœëŒ€ 25ì¼ í•œë„</td></tr>
        </tbody>
      </table>
    </div>
    <div class="policy-card">
      <h4>ğŸ“Œ íœ´ê°€ ìœ í˜•</h4>
      <table class="policy-table">
        <thead><tr><th>ìœ í˜•</th><th>ì°¨ê°</th><th>ì‹œê°„</th></tr></thead>
        <tbody>
          <tr><td>ì—°ì°¨</td><td>1ì¼</td><td>ì¢…ì¼</td></tr>
          <tr><td>ë°˜ì°¨ (ì˜¤ì „)</td><td>0.5ì¼</td><td>09:00 ~ 14:00</td></tr>
          <tr><td>ë°˜ì°¨ (ì˜¤í›„)</td><td>0.5ì¼</td><td>14:00 ~ 18:00</td></tr>
          <tr><td>ë°˜ë°˜ì°¨</td><td>0.25ì¼</td><td>2ì‹œê°„ ë‹¨ìœ„ ì„ íƒ</td></tr>
        </tbody>
      </table>
    </div>
    <div class="policy-card">
      <h4>ğŸ“Œ ì—°ì°¨ ì‚¬ìš© ê·œì •</h4>
      <table class="policy-table">
        <tbody>
          <tr><td>ì‹ ì²­ ë°©ë²•</td><td>ì‹œìŠ¤í…œ ì‹ ì²­ í›„ ëŒ€í‘œë‹˜ ìŠ¹ì¸</td></tr>
          <tr><td>ì‚¬ìš© ê¸°í•œ</td><td>ê°±ì‹ ì¼ ê¸°ì¤€ 1ë…„ ì´ë‚´</td></tr>
          <tr><td>ë¯¸ì‚¬ìš© ì—°ì°¨</td><td>ìˆ˜ë‹¹ìœ¼ë¡œ ì •ì‚° ë˜ëŠ” ì†Œë©¸</td></tr>
          <tr><td>ì·¨ì†Œ ë°©ë²•</td><td>ê´€ë¦¬ìì—ê²Œ ìš”ì²­ í›„ ì‹œìŠ¤í…œì—ì„œ ì·¨ì†Œ</td></tr>
          <tr><td>ì‚¬ìš© ê¶Œì¥</td><td>ì—°ì°¨ì‚¬ìš©ì´‰ì§„ ê¶Œì¥, íŒ€ì›ê°„ ì¼ì • í™•ì¸ í›„ ììœ ë¡­ê²Œ ì‚¬ìš©</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="save-float" id="saveFloat" style="display:none">
  <span class="save-status" id="saveStatus">âš ï¸ ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­</span>
  <button class="btn btn-primary" onclick="saveData()" style="background:linear-gradient(135deg,#4a00e0,#8e2de2)">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
</div>

<!-- Apply Modal -->
<div class="modal-overlay" id="applyModal">
  <div class="modal modal-md">
    <div class="modal-header">
      <h3>ğŸ“ ì—°ì°¨ ì‹ ì²­</h3>
      <button class="modal-close" onclick="closeModal('applyModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="notice-box">
        <span class="notice-icon">ğŸŒ¿</span>
        <div class="notice-text">
          <b>ìš°ë¦¬ íšŒì‚¬ëŠ” ì—°ì°¨ì‚¬ìš©ì´‰ì§„ì„ ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.</b><br>
          íŒ€ì›ê°„ì˜ ì¼ì • í™•ì¸ í›„ ììœ ë¡­ê²Œ ì‚¬ìš© ë°”ëë‹ˆë‹¤.
        </div>
      </div>
      <div class="step-indicator">
        <div class="step active" id="step1">â‘  ì‹ ì²­ì</div>
        <div class="step" id="step2">â‘¡ ìœ í˜•</div>
        <div class="step" id="step3">â‘¢ ë‚ ì§œ</div>
        <div class="step" id="step4">â‘£ í™•ì¸</div>
      </div>
      <div id="applyContent"></div>
    </div>
  </div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" id="detailModal">
  <div class="modal modal-md">
    <div class="modal-header">
      <h3>ğŸ‘¤ ì§ì› ìƒì„¸ ì •ë³´</h3>
      <button class="modal-close" onclick="closeModal('detailModal')">âœ•</button>
    </div>
    <div class="modal-body" id="detailContent"></div>
  </div>
</div>

<!-- Admin Login -->
<div class="modal-overlay" id="adminLoginModal">
  <div class="modal modal-sm">
    <div class="modal-header">
      <h3>ğŸ”’ ê´€ë¦¬ì ì¸ì¦</h3>
      <button class="modal-close" onclick="closeModal('adminLoginModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="adminPwInput" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeydown="if(event.key==='Enter')checkAdminPw()">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('adminLoginModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="checkAdminPw()">í™•ì¸</button>
    </div>
  </div>
</div>

<!-- Admin Panel -->
<div class="modal-overlay" id="adminModal">
  <div class="modal modal-lg">
    <div class="modal-header">
      <h3>âš™ï¸ ê´€ë¦¬ì íŒ¨ë„</h3>
      <button class="modal-close" onclick="closeAdminPanel()">âœ•</button>
    </div>
    <div class="modal-body" id="adminContent"></div>
  </div>
</div>

<!-- Add/Edit Employee -->
<div class="modal-overlay" id="empFormModal">
  <div class="modal modal-sm">
    <div class="modal-header">
      <h3 id="empFormTitle">ğŸ‘¤ ì§ì› ì¶”ê°€</h3>
      <button class="modal-close" onclick="closeModal('empFormModal')">âœ•</button>
    </div>
    <div class="modal-body" id="empFormContent"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('empFormModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" id="empFormSubmit">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- Cancel Confirm -->
<div class="modal-overlay" id="cancelModal">
  <div class="modal modal-sm">
    <div class="modal-header">
      <h3>ğŸ—‘ï¸ íœ´ê°€ ì·¨ì†Œ</h3>
      <button class="modal-close" onclick="closeModal('cancelModal')">âœ•</button>
    </div>
    <div class="modal-body" id="cancelContent"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('cancelModal')">ì•„ë‹ˆì˜¤</button>
      <button class="btn btn-danger" id="cancelConfirmBtn">ì·¨ì†Œ í™•ì •</button>
    </div>
  </div>
</div>

<!-- Renew Confirm -->
<div class="modal-overlay" id="renewModal">
  <div class="modal modal-sm">
    <div class="modal-header">
      <h3>ğŸ”„ ì—°ì°¨ ê°±ì‹ </h3>
      <button class="modal-close" onclick="closeModal('renewModal')">âœ•</button>
    </div>
    <div class="modal-body" id="renewContent"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('renewModal')">ì·¨ì†Œ</button>
      <button class="btn btn-warning" id="renewConfirmBtn">ğŸ”„ ê°±ì‹  ì‹¤í–‰</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const ADMIN_PW='admin1234';
const STORAGE_KEY='prince_leave_v6';
const HOLIDAY_STORAGE_KEY='prince_holidays_v6';

const DEFAULT_HOLIDAYS={
  '2025-12-25':'í¬ë¦¬ìŠ¤ë§ˆìŠ¤',
  '2026-01-01':'ì‹ ì •',
  '2026-02-16':'ì„¤ë‚  ì—°íœ´','2026-02-17':'ì„¤ë‚ ','2026-02-18':'ì„¤ë‚  ì—°íœ´',
  '2026-03-01':'ì‚¼ì¼ì ˆ','2026-03-02':'ëŒ€ì²´ê³µíœ´ì¼(ì‚¼ì¼ì ˆ)',
  '2026-05-05':'ì–´ë¦°ì´ë‚ ','2026-05-24':'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ','2026-05-25':'ëŒ€ì²´ê³µíœ´ì¼(ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ )',
  '2026-06-03':'ì§€ë°©ì„ ê±°ì¼','2026-06-06':'í˜„ì¶©ì¼',
  '2026-07-17':'ì œí—Œì ˆ',
  '2026-08-15':'ê´‘ë³µì ˆ','2026-08-17':'ëŒ€ì²´ê³µíœ´ì¼(ê´‘ë³µì ˆ)',
  '2026-09-24':'ì¶”ì„ ì—°íœ´','2026-09-25':'ì¶”ì„','2026-09-26':'ì¶”ì„ ì—°íœ´',
  '2026-10-03':'ê°œì²œì ˆ','2026-10-05':'ëŒ€ì²´ê³µíœ´ì¼(ê°œì²œì ˆ)','2026-10-09':'í•œê¸€ë‚ ',
  '2026-12-25':'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
};

let customHolidays={};
function getAllHolidays(){return{...DEFAULT_HOLIDAYS,...customHolidays}}

const DEFAULT_EMP=[
{id:'e1',name:'ë„ìŠ¹ì§€',title:'ì‹¤ì¥',empNo:'2',totalLeave:15,remaining:11.25,renewDate:'2026-01',color:'#4a00e0',history:[ {date:'2026-01-01',type:'ì—°ì°¨',detail:'2025ë…„ ì´ˆê³¼ì‚¬ìš© ì°¨ê° (1ì¼ì°¨)'}, {date:'2026-01-01',type:'ì—°ì°¨',detail:'2025ë…„ ì´ˆê³¼ì‚¬ìš© ì°¨ê° (2ì¼ì°¨)'}, {date:'2026-01-01',type:'ë°˜ì°¨',detail:'2025ë…„ ì´ˆê³¼ì‚¬ìš© ì°¨ê° (0.5ì¼)'}, {date:'2026-01-08',type:'ì—°ì°¨',detail:'ì—°ì°¨'}, {date:'2026-01-16',type:'ë°˜ë°˜ì°¨',detail:'ë°˜ë°˜ì°¨'} ]},

  {id:'e2',name:'ì •í›ˆí•„',title:'ëŒ€ë¦¬',empNo:'18',totalLeave:13,remaining:8.25,renewDate:'2025-12',color:'#e74c3c',history:[
    {date:'2025-12-12',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2025-12-23',type:'ë°˜ë°˜ì°¨',detail:'ë°˜ë°˜ì°¨'},
    {date:'2025-12-24',type:'ë°˜ë°˜ì°¨',detail:'ë°˜ë°˜ì°¨'},
    {date:'2026-01-29',type:'ë°˜ì°¨',detail:'ë°˜ì°¨'},
    {date:'2026-02-04',type:'ë°˜ë°˜ì°¨',detail:'ë°˜ë°˜ì°¨'},
    {date:'2026-02-11',type:'ë°˜ì°¨',detail:'ë°˜ì°¨'},
    {date:'2026-02-19',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2026-02-20',type:'ì—°ì°¨',detail:'ì—°ì°¨'}
  ]},
  {id:'e3',name:'ê¹€ì˜í›ˆ',title:'ëŒ€ë¦¬',empNo:'20',totalLeave:13,remaining:9.25,renewDate:'2025-12',color:'#f39c12',history:[
    {date:'2025-12-11',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2026-01-02',type:'ë°˜ë°˜ì°¨',detail:'ë°˜ë°˜ì°¨'},
    {date:'2026-01-12',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2026-01-14',type:'ë°˜ì°¨',detail:'ë°˜ì°¨'},
    {date:'2026-01-28',type:'ë°˜ì°¨',detail:'ë°˜ì°¨'},
    {date:'2026-02-02',type:'ë°˜ì°¨',detail:'ë°˜ì°¨'}
  ]},
  {id:'e4',name:'ìœ ì‹œì€',title:'ì‚¬ì›',empNo:'24',totalLeave:12,remaining:7.75,renewDate:'2025-12',color:'#27ae60',history:[
    {date:'2025-12-11',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2025-12-12',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2026-01-02',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2026-01-22',type:'ë°˜ì°¨',detail:'ë°˜ì°¨'},
    {date:'2026-01-29',type:'ë°˜ë°˜ì°¨',detail:'ë°˜ë°˜ì°¨'},
    {date:'2026-01-30',type:'ë°˜ì°¨',detail:'ë°˜ì°¨'}
  ]},
  {id:'e5',name:'ì§€ì˜ì€',title:'ì‚¬ì›',empNo:'29',totalLeave:6,remaining:2,renewDate:'2025-04',color:'#8e44ad',history:[
    {date:'2025-08-22',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2025-11-28',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2025-12-01',type:'ì—°ì°¨',detail:'ì—°ì°¨'},
    {date:'2026-01-07',type:'ì—°ì°¨',detail:'ì—°ì°¨'}
  ]}
];

let employees=[];
let currentMonth=new Date();
let applyStep=1;
let applyData={empId:null,type:null,halfType:null,quarterTime:null,dates:[]};
let hasUnsaved=false;
let isFirebase=false;
let isAdminMode=false;

// ===== INIT =====
function init(){
  loadData();
  setTodayDisplay();
  renderCalendar();
  renderEmpTable();
}

function loadData(){
  try{
    const saved=localStorage.getItem(STORAGE_KEY);
    if(saved){
      const parsed=JSON.parse(saved);
      if(Array.isArray(parsed)&&parsed.length>0){employees=parsed}
      else{employees=JSON.parse(JSON.stringify(DEFAULT_EMP))}
    }else{employees=JSON.parse(JSON.stringify(DEFAULT_EMP))}
  }catch(e){employees=JSON.parse(JSON.stringify(DEFAULT_EMP))}
  try{
    const savedH=localStorage.getItem(HOLIDAY_STORAGE_KEY);
    if(savedH)customHolidays=JSON.parse(savedH);else customHolidays={};
  }catch(e){customHolidays={}}
}

function setTodayDisplay(){
  const t=new Date(),days=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  document.getElementById('todayDisplay').textContent=`ğŸ“† ${t.getFullYear()}ë…„ ${t.getMonth()+1}ì›” ${t.getDate()}ì¼ (${days[t.getDay()]})`;
}

function switchTab(name){
  document.querySelectorAll('.tab').forEach((t,i)=>{t.classList.toggle('active',(i===0&&name==='dashboard')||(i===1&&name==='policy'))});
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById('sec-'+name).classList.add('active');
}

// ===== SAVE =====
function markUnsaved(){
  hasUnsaved=true;
  document.getElementById('saveFloat').style.display='flex';
}

function saveData(){
  try{
    localStorage.setItem(STORAGE_KEY,JSON.stringify(employees));
    localStorage.setItem(HOLIDAY_STORAGE_KEY,JSON.stringify(customHolidays));
    hasUnsaved=false;
    document.getElementById('saveFloat').style.display='none';
    showToast('ğŸ’¾ ì €ì¥ ì™„ë£Œ! ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ë³´ê´€ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }catch(e){
    showToast('âŒ ì €ì¥ ì‹¤íŒ¨! ë¸Œë¼ìš°ì € ì €ì¥ê³µê°„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
  }
}

function autoSave(){
  try{
    localStorage.setItem(STORAGE_KEY,JSON.stringify(employees));
    localStorage.setItem(HOLIDAY_STORAGE_KEY,JSON.stringify(customHolidays));
    hasUnsaved=false;
    document.getElementById('saveFloat').style.display='none';
    return true;
  }catch(e){
    markUnsaved();
    return false;
  }
}

// ===== CALENDAR =====
function changeMonth(d){currentMonth.setMonth(currentMonth.getMonth()+d);renderCalendar()}

function renderCalendar(){
  const y=currentMonth.getFullYear(),m=currentMonth.getMonth();
  document.getElementById('calTitle').textContent=`${y}ë…„ ${m+1}ì›”`;
  const first=new Date(y,m,1),last=new Date(y,m+1,0);
  const startDay=first.getDay(),totalDays=last.getDate();
  const todayStr=fmt(new Date());
  const holidays=getAllHolidays();
  let html='<thead><tr><th>ì¼</th><th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th></tr></thead><tbody><tr>';
  for(let i=0;i<startDay;i++)html+='<td></td>';
  for(let d=1;d<=totalDays;d++){
    const dow=(startDay+d-1)%7;
    if(dow===0&&d>1)html+='</tr><tr>';
    const ds=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday=ds===todayStr,isSun=dow===0,isSat=dow===6;
    const hol=holidays[ds];
    html+=`<td class="${hol?'holiday-cell':''}">`;
    let dc='cal-date';
    if(isToday)dc+=' today';else if(hol)dc+=' holiday';else if(isSun)dc+=' sunday';else if(isSat)dc+=' saturday';
    html+=`<span class="${dc}">${d}</span>`;
    if(hol)html+=`<span class="cal-holiday-name">${hol}</span>`;
    employees.forEach(emp=>{emp.history.forEach(h=>{if(h.date===ds)html+=`<span class="cal-event type-${h.type}" title="${emp.name} ${h.detail}">${emp.name} ${h.type}</span>`})});
    html+='</td>';
  }
  const remain=(startDay+totalDays)%7;
  if(remain>0)for(let i=remain;i<7;i++)html+='<td></td>';
  html+='</tr></tbody>';
  document.getElementById('calendarTable').innerHTML=html;
}

function fmt(d){return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}

// ===== EMPLOYEE TABLE =====
function renderEmpTable(){
  const used=e=>+(e.totalLeave-e.remaining).toFixed(2);
  const pct=e=>e.totalLeave>0?Math.round((used(e)/e.totalLeave)*100):0;
  let html=`<thead><tr><th style="text-align:left;padding-left:16px">ì§ì›ëª…</th><th>ì‚¬ë²ˆ</th><th>ì´ì—°ì°¨</th><th>ì‚¬ìš©</th><th>ì”ì—¬</th><th>ì‚¬ìš©ë¥ </th><th>ê°±ì‹ ì¼</th></tr></thead><tbody>`;
  employees.forEach(e=>{
    const u=used(e),p=pct(e);
    const remColor=e.remaining<=2?'#e74c3c':e.remaining<=5?'#f39c12':'#27ae60';
    const statusBg=e.remaining<=2?'#fee':e.remaining<=5?'#fff8e1':'#e8f5e9';
    const gaugeColor=p>=80?'#e74c3c':p>=50?'#f39c12':'#27ae60';
    html+=`<tr>
      <td><div class="emp-name-cell" onclick="openDetail('${e.id}')">
        <div class="emp-avatar" style="background:${e.color}">${e.name[0]}</div>
        <div class="emp-name-info"><div class="name">${e.name}</div><div class="title">${e.title}</div></div>
      </div></td>
      <td>${e.empNo}</td><td><b>${e.totalLeave}ì¼</b></td><td>${u}ì¼</td>
      <td><span class="remaining-badge" style="background:${statusBg};color:${remColor}">${e.remaining}ì¼</span></td>
      <td><div class="gauge-wrap"><div class="gauge-bar"><div class="gauge-fill" style="width:${p}%;background:${gaugeColor}"></div></div><span class="gauge-text">${p}%</span></div></td>
      <td style="font-size:.8rem;color:#888">${e.renewDate.replace('-','ë…„ ')}ì›”</td>
    </tr>`;
  });
  html+='</tbody>';
  document.getElementById('empTable').innerHTML=html;
}

// ===== DETAIL (ì·¨ì†Œ ë²„íŠ¼ ê´€ë¦¬ì ì „ìš©) =====
function openDetail(id){
  const e=employees.find(x=>x.id===id);if(!e)return;
  const used=+(e.totalLeave-e.remaining).toFixed(2);
  const pct=e.totalLeave>0?Math.round((used/e.totalLeave)*100):0;
  const gaugeColor=pct>=80?'#e74c3c':pct>=50?'#f39c12':'#27ae60';
  let html=`
    <div class="detail-top">
      <div class="detail-avatar" style="background:${e.color}">${e.name[0]}</div>
      <div class="detail-info"><h4>${e.name}</h4><p>${e.title} Â· ì‚¬ë²ˆ ${e.empNo}</p></div>
    </div>
    <div class="detail-stats">
      <div class="detail-stat"><div class="ds-label">ì´ ì—°ì°¨</div><div class="ds-value">${e.totalLeave}ì¼</div></div>
      <div class="detail-stat"><div class="ds-label">ì‚¬ìš©</div><div class="ds-value" style="color:#e74c3c">${used}ì¼</div></div>
      <div class="detail-stat"><div class="ds-label">ì”ì—¬</div><div class="ds-value" style="color:#27ae60">${e.remaining}ì¼</div></div>
      <div class="detail-stat"><div class="ds-label">ê°±ì‹ ì¼</div><div class="ds-value" style="font-size:.9rem">${e.renewDate.replace('-','.')}</div></div>
    </div>
    <div class="detail-gauge">
      <div style="display:flex;justify-content:space-between;margin-bottom:4px;font-size:.8rem"><span>ì‚¬ìš©ë¥ </span><span>${pct}%</span></div>
      <div class="gauge-bar"><div class="gauge-fill" style="width:${pct}%;background:${gaugeColor}"></div></div>
    </div>
    <h4 style="margin-bottom:10px;font-size:.95rem">ğŸ“‹ ì‚¬ìš© ì´ë ¥</h4>`;

  if(!isAdminMode){
    html+=`<div style="background:#f8f9fa;border-radius:8px;padding:8px 12px;margin-bottom:10px;font-size:.78rem;color:#888;display:flex;align-items:center;gap:6px;">ğŸ”’ ì·¨ì†ŒëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì·¨ì†Œê°€ í•„ìš”í•˜ë©´ ê´€ë¦¬ìì—ê²Œ ìš”ì²­í•˜ì„¸ìš”.</div>`;
  }

  html+='<div class="history-list">';
  if(e.history.length===0){html+='<p style="text-align:center;color:#aaa;padding:20px">ì‚¬ìš© ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
  else{
    const sorted=[...e.history].sort((a,b)=>b.date.localeCompare(a.date));
    sorted.forEach(h=>{
      const typeColor=h.type==='ì—°ì°¨'?'#4a00e0':h.type==='ë°˜ì°¨'?'#f39c12':'#27ae60';
      const origIdx=e.history.indexOf(h);
      html+=`<div class="history-item">
        <div style="display:flex;align-items:center;gap:10px">
          <span class="history-type" style="background:${typeColor}">${h.type}</span>
          <span>${h.date}</span><span style="color:#888;font-size:.8rem">${h.detail}</span>
        </div>`;
      if(isAdminMode){
        html+=`<button class="history-cancel-btn" onclick="openCancelConfirm('${e.id}',${origIdx})">âŒ ì·¨ì†Œ</button>`;
      }else{
        html+=`<button class="history-cancel-btn" disabled title="ê´€ë¦¬ìë§Œ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤">ğŸ”’ ì·¨ì†Œ</button>`;
      }
      html+=`</div>`;
    });
  }
  html+='</div>';
  document.getElementById('detailContent').innerHTML=html;
  openModal('detailModal');
}

// ===== CANCEL (ìë™ì €ì¥ í¬í•¨) =====
function openCancelConfirm(empId,histIdx){
  if(!isAdminMode){showToast('âŒ ê´€ë¦¬ìë§Œ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');return}
  const emp=employees.find(x=>x.id===empId);if(!emp||!emp.history[histIdx])return;
  const h=emp.history[histIdx];
  const typeColor=h.type==='ì—°ì°¨'?'#4a00e0':h.type==='ë°˜ì°¨'?'#f39c12':'#27ae60';
  const deduct=h.type==='ì—°ì°¨'?1:h.type==='ë°˜ì°¨'?0.5:0.25;
  let html=`
    <div style="text-align:center;margin-bottom:16px"><div style="font-size:2.5rem;margin-bottom:8px">âš ï¸</div>
    <p style="font-size:1rem;font-weight:700;margin-bottom:8px">ì´ íœ´ê°€ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p></div>
    <div style="background:#f8f9fa;border-radius:10px;padding:16px;margin-bottom:16px">
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">ì§ì›</span><span style="font-weight:700">${emp.name} ${emp.title}</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">ë‚ ì§œ</span><span style="font-weight:700">${h.date}</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">ìœ í˜•</span><span class="history-type" style="background:${typeColor};padding:3px 10px;border-radius:10px;color:#fff;font-size:.8rem">${h.type}</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">ìƒì„¸</span><span style="font-weight:700">${h.detail}</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem;border-top:1px dashed #ddd;margin-top:6px;padding-top:8px"><span style="color:#888">ë³µêµ¬ ì¼ìˆ˜</span><span style="font-weight:700;color:#27ae60">+${deduct}ì¼</span></div>
    </div>`;
  document.getElementById('cancelContent').innerHTML=html;
  document.getElementById('cancelConfirmBtn').onclick=function(){executeCancel(empId,histIdx)};
  openModal('cancelModal');
}

function executeCancel(empId,histIdx){
  if(!isAdminMode){showToast('âŒ ê´€ë¦¬ìë§Œ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');return}
  const emp=employees.find(x=>x.id===empId);if(!emp||!emp.history[histIdx])return;
  const h=emp.history[histIdx];
  const deduct=h.type==='ì—°ì°¨'?1:h.type==='ë°˜ì°¨'?0.5:0.25;
  const msg=`ëŒ€í‘œë‹˜, ${emp.name}ë‹˜ì˜ ${h.date} ${h.type} ì‚¬ìš©ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.`;
  emp.remaining=Math.round((emp.remaining+deduct)*100)/100;
  emp.history.splice(histIdx,1);
  copyToClipboard(msg);

  if(autoSave()){
    showToast('âœ… ì·¨ì†Œ ì™„ë£Œ! ìë™ ì €ì¥ ë° ì·¨ì†Œ ë©”ì‹œì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }else{
    showToast('âœ… ì·¨ì†Œ ì™„ë£Œ! ë©”ì‹œì§€ ë³µì‚¬ë¨. âš ï¸ ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
  }

  closeModal('cancelModal');
  openDetail(empId);
  renderCalendar();renderEmpTable();
}

// ===== APPLY =====
function openApplyModal(){
  applyStep=1;applyData={empId:null,type:null,halfType:null,quarterTime:null,dates:[]};
  updateApplySteps();renderApplyStep();openModal('applyModal');
}
function updateApplySteps(){for(let i=1;i<=4;i++){const el=document.getElementById('step'+i);el.classList.remove('active','done');if(i<applyStep)el.classList.add('done');else if(i===applyStep)el.classList.add('active')}}
function renderApplyStep(){const c=document.getElementById('applyContent');if(applyStep===1)renderStep1(c);else if(applyStep===2)renderStep2(c);else if(applyStep===3)renderStep3(c);else renderStep4(c)}

function renderStep1(c){
  let html='<p style="margin-bottom:14px;font-weight:600;color:#555">ì‹ ì²­ìë¥¼ ì„ íƒí•˜ì„¸ìš”</p><div class="emp-grid">';
  employees.forEach(e=>{html+=`<div class="emp-card ${applyData.empId===e.id?'selected':''}" onclick="selectEmp('${e.id}')"><div class="avatar" style="background:${e.color}">${e.name[0]}</div><div class="ename">${e.name}</div><div class="etitle">${e.title}</div><div style="font-size:.7rem;color:#aaa;margin-top:2px">ì”ì—¬ ${e.remaining}ì¼</div></div>`});
  html+='</div>';c.innerHTML=html;
}
function selectEmp(id){applyData.empId=id;applyStep=2;updateApplySteps();renderApplyStep()}

function renderStep2(c){
  const emp=employees.find(x=>x.id===applyData.empId);
  let html=`<p style="margin-bottom:14px;font-weight:600;color:#555">${emp.name}ë‹˜ì˜ íœ´ê°€ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</p>
  <div class="type-grid">
    <div class="type-card ${applyData.type==='ì—°ì°¨'?'selected':''}" onclick="selectType('ì—°ì°¨')"><div class="ticon">ğŸŒ´</div><div class="tname">ì—°ì°¨</div><div class="tdesc">1ì¼ ì°¨ê°</div></div>
    <div class="type-card ${applyData.type==='ë°˜ì°¨'?'selected':''}" onclick="selectType('ë°˜ì°¨')"><div class="ticon">ğŸŒ¤ï¸</div><div class="tname">ë°˜ì°¨</div><div class="tdesc">0.5ì¼ ì°¨ê°</div></div>
    <div class="type-card ${applyData.type==='ë°˜ë°˜ì°¨'?'selected':''}" onclick="selectType('ë°˜ë°˜ì°¨')"><div class="ticon">â°</div><div class="tname">ë°˜ë°˜ì°¨</div><div class="tdesc">0.25ì¼ ì°¨ê°</div></div>
  </div>`;
  if(applyData.type==='ë°˜ì°¨'){html+=`<div class="half-options"><button class="btn ${applyData.halfType==='ì˜¤ì „'?'selected':''}" onclick="applyData.halfType='ì˜¤ì „';renderApplyStep()">ğŸŒ… ì˜¤ì „ (9ì‹œ30ë¶„~14ì‹œ)</button><button class="btn ${applyData.halfType==='ì˜¤í›„'?'selected':''}" onclick="applyData.halfType='ì˜¤í›„';renderApplyStep()">ğŸŒ‡ ì˜¤í›„ (14ì‹œ~18ì‹œ)</button></div>`}
  if(applyData.type==='ë°˜ë°˜ì°¨'){const times=['09:30~11:30','13:00~15:00','14:00~16:00','15:00~17:00','16:00~18:00'];html+='<div class="quarter-options">';times.forEach(t=>{html+=`<button class="btn ${applyData.quarterTime===t?'selected':''}" onclick="applyData.quarterTime='${t}';renderApplyStep()">${t}</button>`});html+='</div>'}
  const canNext=applyData.type&&(applyData.type==='ì—°ì°¨'||(applyData.type==='ë°˜ì°¨'&&applyData.halfType)||(applyData.type==='ë°˜ë°˜ì°¨'&&applyData.quarterTime));
  html+=`<div style="margin-top:16px;display:flex;justify-content:space-between"><button class="btn btn-secondary" onclick="applyStep=1;updateApplySteps();renderApplyStep()">â—€ ì´ì „</button><button class="btn btn-primary" ${canNext?'':`disabled style="opacity:.4;cursor:default"`} onclick="applyStep=3;updateApplySteps();renderApplyStep()">ë‹¤ìŒ â–¶</button></div>`;
  c.innerHTML=html;
}
function selectType(t){applyData.type=t;if(t==='ì—°ì°¨'){applyData.halfType=null;applyData.quarterTime=null}else if(t==='ë°˜ì°¨'){applyData.quarterTime=null}else{applyData.halfType=null}renderApplyStep()}

function renderStep3(c){
  let html=`<p style="margin-bottom:14px;font-weight:600;color:#555">ì‚¬ìš©ì¼ì„ ì„ íƒí•˜ì„¸ìš” (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</p>
  <div class="date-input-area"><input type="date" onchange="addApplyDate(this.value);this.value=''" style="padding:10px;border:1px solid #ddd;border-radius:8px;font-size:.9rem;width:100%"><div class="selected-dates">`;
  applyData.dates.forEach(d=>{html+=`<span class="date-tag">${d}<span class="remove" onclick="removeApplyDate('${d}')">âœ•</span></span>`});
  html+=`</div></div><div style="margin-top:16px;display:flex;justify-content:space-between"><button class="btn btn-secondary" onclick="applyStep=2;updateApplySteps();renderApplyStep()">â—€ ì´ì „</button><button class="btn btn-primary" ${applyData.dates.length?'':`disabled style="opacity:.4;cursor:default"`} onclick="applyStep=4;updateApplySteps();renderApplyStep()">ë‹¤ìŒ â–¶</button></div>`;
  c.innerHTML=html;
}
function addApplyDate(v){
  if(!v||applyData.dates.includes(v))return;
  const holidays=getAllHolidays();
  const d=new Date(v);const dow=d.getDay();
  if(dow===0||dow===6){showToast('âŒ ì£¼ë§ì—ëŠ” ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');return}
  if(holidays[v]){showToast('âŒ ê³µíœ´ì¼ì—ëŠ” ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');return}
  const emp=employees.find(x=>x.id===applyData.empId);
  if(emp){
    const dup=emp.history.find(h=>h.date===v);
    if(dup){showToast(`âŒ ${v}ì— ì´ë¯¸ ${dup.type}ì´(ê°€) ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`);return}
  }
  applyData.dates.push(v);applyData.dates.sort();renderApplyStep();
}
function removeApplyDate(v){applyData.dates=applyData.dates.filter(d=>d!==v);renderApplyStep()}

function renderStep4(c){
  const emp=employees.find(x=>x.id===applyData.empId);
  const detail=applyData.type==='ë°˜ì°¨'?`${applyData.halfType} ë°˜ì°¨`:applyData.type==='ë°˜ë°˜ì°¨'?`ë°˜ë°˜ì°¨(${applyData.quarterTime})`:'ì—°ì°¨';
  const deductPer=applyData.type==='ì—°ì°¨'?1:applyData.type==='ë°˜ì°¨'?0.5:0.25;
  const totalDeduct=deductPer*applyData.dates.length;
  const dateStr=applyData.dates.join(', ');
  const msg=`ëŒ€í‘œë‹˜, ${dateStr}ì— ${detail}ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ìŠ¹ì¸ë¶€íƒë“œë¦½ë‹ˆë‹¤.`;
  const afterRemain=Math.round((emp.remaining-totalDeduct)*100)/100;
  let html=`<div class="confirm-box">
    <div class="confirm-row"><span class="label">ì‹ ì²­ì</span><span class="value">${emp.name} ${emp.title}</span></div>
    <div class="confirm-row"><span class="label">ìœ í˜•</span><span class="value">${detail}</span></div>
    <div class="confirm-row"><span class="label">ë‚ ì§œ</span><span class="value">${dateStr}</span></div>
    <div class="confirm-row"><span class="label">ì°¨ê° ì¼ìˆ˜</span><span class="value" style="color:#e74c3c">-${totalDeduct}ì¼</span></div>
    <div class="confirm-row"><span class="label">ì”ì—¬ ì˜ˆìƒ</span><span class="value" style="color:${afterRemain<0?'#e74c3c':'#27ae60'}">${afterRemain}ì¼</span></div>
  </div>`;
  if(afterRemain<0){
    html+=`<div style="background:#fee;border:1px solid #e74c3c;border-radius:8px;padding:12px;margin-top:12px;color:#e74c3c;font-size:.85rem;font-weight:600;">âš ï¸ ì”ì—¬ ì—°ì°¨ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
  }
  html+=`<div class="copy-msg-box">ğŸ“‹ ìŠ¹ì¸ ìš”ì²­ ë©”ì‹œì§€ (ì‹ ì²­ ì‹œ ìë™ ë³µì‚¬):<br><br><b>${msg}</b></div>
  <div style="margin-top:16px;display:flex;justify-content:space-between"><button class="btn btn-secondary" onclick="applyStep=3;updateApplySteps();renderApplyStep()">â—€ ì´ì „</button><button class="btn btn-fire" ${afterRemain<0?'disabled style="opacity:.4;cursor:default"':''}onclick="submitApply()">âœ… ì‹ ì²­ ì™„ë£Œ</button></div>`;
  c.innerHTML=html;
}

function submitApply(){
  const emp=employees.find(x=>x.id===applyData.empId);if(!emp)return;
  const detail=applyData.type==='ë°˜ì°¨'?`${applyData.halfType} ë°˜ì°¨`:applyData.type==='ë°˜ë°˜ì°¨'?`ë°˜ë°˜ì°¨(${applyData.quarterTime})`:'ì—°ì°¨';
  const deductPer=applyData.type==='ì—°ì°¨'?1:applyData.type==='ë°˜ì°¨'?0.5:0.25;
  const totalDeduct=deductPer*applyData.dates.length;
  if(emp.remaining<totalDeduct){showToast('âŒ ì”ì—¬ ì—°ì°¨ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');return}

  applyData.dates.forEach(d=>{emp.history.push({date:d,type:applyData.type,detail})});
  emp.history.sort((a,b)=>a.date.localeCompare(b.date));
  emp.remaining=Math.round((emp.remaining-totalDeduct)*100)/100;

  const dateStr=applyData.dates.join(', ');
  const msg=`ëŒ€í‘œë‹˜, ${dateStr}ì— ${detail}ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ìŠ¹ì¸ë¶€íƒë“œë¦½ë‹ˆë‹¤.`;
  copyToClipboard(msg);

  if(autoSave()){
    showToast(`âœ… ${emp.name}ë‹˜ ì—°ì°¨ ì‹ ì²­ ì™„ë£Œ! ìë™ ì €ì¥ ë° ë©”ì‹œì§€ ë³µì‚¬ ì™„ë£Œ`);
  }else{
    showToast(`âœ… ${emp.name}ë‹˜ ì—°ì°¨ ì‹ ì²­ ì™„ë£Œ! ë©”ì‹œì§€ ë³µì‚¬ë¨. âš ï¸ ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`);
  }

  closeModal('applyModal');renderCalendar();renderEmpTable();
}

// ===== ADMIN =====
function openAdminLogin(){document.getElementById('adminPwInput').value='';openModal('adminLoginModal');setTimeout(()=>document.getElementById('adminPwInput').focus(),200)}

function checkAdminPw(){
  if(document.getElementById('adminPwInput').value===ADMIN_PW){
    isAdminMode=true;
    closeModal('adminLoginModal');
    renderAdminPanel();
    openModal('adminModal');
  }else{
    showToast('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤');
  }
}

function closeAdminPanel(){
  isAdminMode=false;
  closeModal('adminModal');
}

function renderAdminPanel(){
  let html='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><h4>ğŸ‘¥ ì§ì› ê´€ë¦¬</h4><button class="btn btn-primary" onclick="openAddEmpForm()">+ ì‹ ê·œ ì§ì› ì¶”ê°€</button></div><div class="admin-grid">';
  employees.forEach(e=>{
    html+=`<div class="admin-emp-card">
      <div class="admin-emp-top"><div class="avatar" style="background:${e.color}">${e.name[0]}</div><div class="info"><div class="name">${e.name} ${e.title}</div><div class="sub">ì‚¬ë²ˆ ${e.empNo} Â· ì”ì—¬ ${e.remaining}/${e.totalLeave}ì¼ Â· ê°±ì‹  ${e.renewDate}</div></div></div>
      <div class="admin-actions">
        <button class="btn btn-outline" onclick="openEditEmpForm('${e.id}')">âœï¸ ìˆ˜ì •</button>
        <button class="btn btn-outline" onclick="grantLeave('${e.id}')">â• ì—°ì°¨ë¶€ì—¬</button>
        <button class="btn btn-warning" onclick="openRenewModal('${e.id}')">ğŸ”„ ê°±ì‹ </button>
        <button class="btn btn-outline" onclick="openDetail('${e.id}')">ğŸ“‹ ì´ë ¥</button>
        <button class="btn btn-danger" onclick="deleteEmp('${e.id}')">ğŸ—‘ï¸ ì‚­ì œ</button>
      </div>
    </div>`;
  });
  html+='</div>';

  html+=`<div class="holiday-admin"><h4>ğŸ“… ê³µíœ´ì¼ ê´€ë¦¬</h4>
    <div class="holiday-add-row"><div class="form-group"><label>ë‚ ì§œ</label><input type="date" id="hol_date"></div><div class="form-group"><label>ê³µíœ´ì¼ëª…</label><input id="hol_name" placeholder="ì˜ˆ: ì„ì‹œê³µíœ´ì¼"></div><button class="btn btn-success" onclick="addCustomHoliday()" style="height:42px;margin-top:auto">+ ì¶”ê°€</button></div>
    <div class="holiday-list">`;
  const allDates=[...new Set([...Object.keys(DEFAULT_HOLIDAYS),...Object.keys(customHolidays)])].sort();
  allDates.forEach(d=>{
    const isDefault=DEFAULT_HOLIDAYS[d]!==undefined;const isCustom=customHolidays[d]!==undefined;
    const name=isCustom?customHolidays[d]:DEFAULT_HOLIDAYS[d];
    html+=`<div class="holiday-item"><span class="hi-date">${d}</span><span class="hi-name">${name}</span><span class="hi-type ${isDefault&&!isCustom?'default':'custom'}">${isDefault&&!isCustom?'ê¸°ë³¸':'ê´€ë¦¬ì ì¶”ê°€'}</span>${isCustom?`<button class="holiday-del-btn" onclick="deleteCustomHoliday('${d}')">ì‚­ì œ</button>`:`<span style="font-size:.7rem;color:#ccc;min-width:32px;text-align:center">â€”</span>`}</div>`;
  });
  html+='</div></div>';

  html+=`<div class="data-tools"><h4>ğŸ”§ ë°ì´í„° ê´€ë¦¬</h4><div class="btn-row"><button class="btn btn-outline" onclick="exportData()">ğŸ“¤ ë‚´ë³´ë‚´ê¸° (JSON)</button><button class="btn btn-outline" onclick="document.getElementById('importFile').click()">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button><input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)"><button class="btn btn-danger" onclick="resetAllData()">âš ï¸ ì „ì²´ ì´ˆê¸°í™”</button></div></div>`;
  document.getElementById('adminContent').innerHTML=html;
}

// ===== RENEW =====
function openRenewModal(id){
  const e=employees.find(x=>x.id===id);if(!e)return;
  const used=+(e.totalLeave-e.remaining).toFixed(2);
  const histCount=e.history.length;
  let html=`
    <div style="text-align:center;margin-bottom:16px"><div style="font-size:2.5rem;margin-bottom:8px">ğŸ”„</div>
    <p style="font-size:1.05rem;font-weight:700">${e.name} ${e.title} ì—°ì°¨ ê°±ì‹ </p></div>
    <div style="background:#f8f9fa;border-radius:10px;padding:16px;margin-bottom:16px">
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">í˜„ì¬ ì´ì—°ì°¨</span><span style="font-weight:700">${e.totalLeave}ì¼</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">ì‚¬ìš©</span><span style="font-weight:700;color:#e74c3c">${used}ì¼</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">ì”ì—¬</span><span style="font-weight:700;color:#27ae60">${e.remaining}ì¼</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">ì‚¬ìš© ì´ë ¥</span><span style="font-weight:700">${histCount}ê±´</span></div>
      <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.9rem"><span style="color:#888">í˜„ì¬ ê°±ì‹ ì›”</span><span style="font-weight:700">${e.renewDate}</span></div>
    </div>
    <div class="form-group"><label>ìƒˆ ì´ ì—°ì°¨ì¼ìˆ˜</label><input type="number" id="renew_total" value="${e.totalLeave}" step="0.5"></div>
    <div class="form-group"><label>ìƒˆ ê°±ì‹ ë…„ì›”</label><input type="month" id="renew_date" value="${fmt(new Date()).substring(0,7)}"></div>
    <div class="renew-info">
      âš ï¸ <b>ê°±ì‹  ì‹œ ì ìš© ì‚¬í•­:</b><br>
      â€¢ ì´ì „ ì‚¬ìš© ì´ë ¥ <b>${histCount}ê±´ ì „ì²´ ì‚­ì œ</b><br>
      â€¢ ì”ì—¬ì¼ = ìƒˆ ì´ ì—°ì°¨ì¼ìˆ˜ë¡œ ë¦¬ì…‹<br>
      â€¢ ê°±ì‹ ì›”ì´ ìƒˆ ë‚ ì§œë¡œ ë³€ê²½<br>
      â€¢ <b>ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</b>
    </div>`;
  document.getElementById('renewContent').innerHTML=html;
  document.getElementById('renewConfirmBtn').onclick=function(){executeRenew(id)};
  openModal('renewModal');
}

function executeRenew(id){
  const e=employees.find(x=>x.id===id);if(!e)return;
  const newTotal=parseFloat(document.getElementById('renew_total').value);
  const newDate=document.getElementById('renew_date').value;
  if(isNaN(newTotal)||newTotal<=0){showToast('âŒ ì˜¬ë°”ë¥¸ ì—°ì°¨ì¼ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');return}
  if(!newDate){showToast('âŒ ê°±ì‹ ë…„ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”');return}
  if(!confirm(`${e.name}ë‹˜ì˜ ì—°ì°¨ë¥¼ ê°±ì‹ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ ì´ì „ ì´ë ¥ ${e.history.length}ê±´ ì‚­ì œ\nâ€¢ ì´ì—°ì°¨: ${newTotal}ì¼\nâ€¢ ì”ì—¬: ${newTotal}ì¼\nâ€¢ ê°±ì‹ ì›”: ${newDate}`))return;
  e.history=[];
  e.totalLeave=newTotal;
  e.remaining=newTotal;
  e.renewDate=newDate;

  if(autoSave()){
    showToast(`âœ… ${e.name}ë‹˜ ì—°ì°¨ ê°±ì‹  ì™„ë£Œ! ìë™ ì €ì¥ë¨ (${newTotal}ì¼, ì´ë ¥ ì´ˆê¸°í™”)`);
  }else{
    markUnsaved();
    showToast(`âœ… ${e.name}ë‹˜ ì—°ì°¨ ê°±ì‹  ì™„ë£Œ! âš ï¸ ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`);
  }

  closeModal('renewModal');
  renderAdminPanel();renderCalendar();renderEmpTable();
}

// ===== ê³µíœ´ì¼ ê´€ë¦¬ =====
function addCustomHoliday(){
  const date=document.getElementById('hol_date').value;const name=document.getElementById('hol_name').value.trim();
  if(!date){showToast('âŒ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');return}
  if(!name){showToast('âŒ ê³µíœ´ì¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return}
  customHolidays[date]=name;

  if(autoSave()){
    showToast(`âœ… ${date} "${name}" ê³µíœ´ì¼ ì¶”ê°€ ë° ìë™ ì €ì¥`);
  }else{
    markUnsaved();
    showToast(`âœ… ${date} "${name}" ê³µíœ´ì¼ ì¶”ê°€. âš ï¸ ì €ì¥ í•„ìš”`);
  }

  renderAdminPanel();renderCalendar();
}

function deleteCustomHoliday(date){
  if(!confirm(`"${customHolidays[date]}" ê³µíœ´ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;
  delete customHolidays[date];

  if(autoSave()){
    showToast('âœ… ê³µíœ´ì¼ ì‚­ì œ ë° ìë™ ì €ì¥ ì™„ë£Œ');
  }else{
    markUnsaved();
    showToast('âœ… ê³µíœ´ì¼ ì‚­ì œ. âš ï¸ ì €ì¥ í•„ìš”');
  }

  renderAdminPanel();renderCalendar();
}

// ===== ì§ì› CRUD =====
function openAddEmpForm(){
  document.getElementById('empFormTitle').textContent='ğŸ‘¤ ì‹ ê·œ ì§ì› ì¶”ê°€';
  const colors=['#4a00e0','#e74c3c','#f39c12','#27ae60','#8e44ad','#3498db','#e67e22','#1abc9c'];
  let html=`<div class="form-row"><div class="form-group"><label>ì´ë¦„</label><input id="ef_name" placeholder="í™ê¸¸ë™"></div><div class="form-group"><label>ì§ê¸‰</label><input id="ef_title" placeholder="ì‚¬ì›"></div></div>
  <div class="form-row"><div class="form-group"><label>ì‚¬ì›ë²ˆí˜¸</label><input id="ef_empNo" placeholder="30"></div><div class="form-group"><label>ì´ ì—°ì°¨ì¼ìˆ˜</label><input type="number" id="ef_total" value="15"></div></div>
  <div class="form-row"><div class="form-group"><label>ê°±ì‹ ë…„ì›”</label><input type="month" id="ef_renew" value="2026-01"></div><div class="form-group"><label>ëŒ€í‘œìƒ‰ìƒ</label><div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:4px" id="ef_colors">${colors.map(c=>`<div onclick="document.querySelectorAll('#ef_colors div').forEach(x=>x.style.outline='none');this.style.outline='3px solid #333';document.getElementById('ef_color_val').value='${c}'" style="width:28px;height:28px;border-radius:50%;background:${c};cursor:pointer"></div>`).join('')}</div><input type="hidden" id="ef_color_val" value="${colors[0]}"></div></div>`;
  document.getElementById('empFormContent').innerHTML=html;
  document.getElementById('empFormSubmit').onclick=addEmployee;openModal('empFormModal');
}

function addEmployee(){
  const name=document.getElementById('ef_name').value.trim(),title=document.getElementById('ef_title').value.trim(),empNo=document.getElementById('ef_empNo').value.trim();
  const total=parseFloat(document.getElementById('ef_total').value)||15,renew=document.getElementById('ef_renew').value||'2026-01',color=document.getElementById('ef_color_val').value;
  if(!name){showToast('âŒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return}
  if(employees.find(e=>e.empNo===empNo)){showToast('âŒ ì¤‘ë³µëœ ì‚¬ë²ˆì…ë‹ˆë‹¤');return}
  employees.push({id:'e'+Date.now(),name,title,empNo,totalLeave:total,remaining:total,renewDate:renew,color,history:[]});

  if(autoSave()){
    showToast(`âœ… ${name}ë‹˜ì´ ì¶”ê°€ ë° ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤`);
  }else{
    markUnsaved();
    showToast(`âœ… ${name}ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. âš ï¸ ì €ì¥ í•„ìš”`);
  }

  closeModal('empFormModal');renderAdminPanel();renderCalendar();renderEmpTable();
}

function openEditEmpForm(id){
  const e=employees.find(x=>x.id===id);if(!e)return;
  document.getElementById('empFormTitle').textContent='âœï¸ ì§ì› ì •ë³´ ìˆ˜ì •';
  let html=`<div class="form-row"><div class="form-group"><label>ì´ë¦„</label><input id="ef_name" value="${e.name}"></div><div class="form-group"><label>ì§ê¸‰</label><input id="ef_title" value="${e.title}"></div></div>
  <div class="form-row"><div class="form-group"><label>ì‚¬ì›ë²ˆí˜¸</label><input id="ef_empNo" value="${e.empNo}"></div><div class="form-group"><label>ì´ ì—°ì°¨ì¼ìˆ˜</label><input type="number" id="ef_total" value="${e.totalLeave}" step="0.5"></div></div>
  <div class="form-row"><div class="form-group"><label>ì”ì—¬ ì—°ì°¨</label><input type="number" id="ef_remain" value="${e.remaining}" step="0.25"></div><div class="form-group"><label>ê°±ì‹ ë…„ì›”</label><input type="month" id="ef_renew" value="${e.renewDate}"></div></div>`;
  document.getElementById('empFormContent').innerHTML=html;
  document.getElementById('empFormSubmit').onclick=function(){
    e.name=document.getElementById('ef_name').value.trim()||e.name;e.title=document.getElementById('ef_title').value.trim()||e.title;
    e.empNo=document.getElementById('ef_empNo').value.trim()||e.empNo;e.totalLeave=parseFloat(document.getElementById('ef_total').value)||e.totalLeave;
    e.remaining=parseFloat(document.getElementById('ef_remain').value);if(isNaN(e.remaining))e.remaining=0;
    e.renewDate=document.getElementById('ef_renew').value||e.renewDate;

    if(autoSave()){
      showToast(`âœ… ${e.name}ë‹˜ ì •ë³´ ìˆ˜ì • ë° ìë™ ì €ì¥ ì™„ë£Œ`);
    }else{
      markUnsaved();
      showToast(`âœ… ${e.name}ë‹˜ ì •ë³´ ìˆ˜ì • ì™„ë£Œ. âš ï¸ ì €ì¥ í•„ìš”`);
    }

    closeModal('empFormModal');renderAdminPanel();renderCalendar();renderEmpTable();
  };openModal('empFormModal');
}

function grantLeave(id){
  const e=employees.find(x=>x.id===id);if(!e)return;
  const days=prompt(`${e.name}ë‹˜ì—ê²Œ ì¶”ê°€ ë¶€ì—¬í•  ì—°ì°¨ ì¼ìˆ˜:`,1);if(days===null)return;
  const d=parseFloat(days);if(isNaN(d)||d<=0){showToast('âŒ ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');return}
  e.totalLeave=Math.round((e.totalLeave+d)*100)/100;e.remaining=Math.round((e.remaining+d)*100)/100;

  if(autoSave()){
    showToast(`âœ… ${e.name}ë‹˜ì—ê²Œ ${d}ì¼ ì¶”ê°€ ë¶€ì—¬ ë° ìë™ ì €ì¥`);
  }else{
    markUnsaved();
    showToast(`âœ… ${e.name}ë‹˜ì—ê²Œ ${d}ì¼ ì¶”ê°€ ë¶€ì—¬. âš ï¸ ì €ì¥ í•„ìš”`);
  }

  renderAdminPanel();renderEmpTable();
}

function deleteEmp(id){
  const e=employees.find(x=>x.id===id);if(!e)return;
  if(!confirm(`ì •ë§ ${e.name}ë‹˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`))return;
  employees=employees.filter(x=>x.id!==id);

  if(autoSave()){
    showToast(`âœ… ${e.name}ë‹˜ ì‚­ì œ ë° ìë™ ì €ì¥ ì™„ë£Œ`);
  }else{
    markUnsaved();
    showToast(`âœ… ${e.name}ë‹˜ ì‚­ì œ. âš ï¸ ì €ì¥ í•„ìš”`);
  }

  renderAdminPanel();renderCalendar();renderEmpTable();
}

// ===== DATA TOOLS =====
function exportData(){
  const data={employees,customHolidays,exportDate:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');
  a.href=url;a.download=`prince_leave_backup_${fmt(new Date())}.json`;a.click();
  URL.revokeObjectURL(url);showToast('ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ');
}

function importData(event){
  const file=event.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=function(ev){
    try{const data=JSON.parse(ev.target.result);
      if(Array.isArray(data)){employees=data}
      else if(data.employees){employees=data.employees;if(data.customHolidays)customHolidays=data.customHolidays}
      else{showToast('âŒ ì˜¬ë°”ë¥¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤');return}
      if(autoSave()){
        showToast('ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° ìë™ ì €ì¥ ì™„ë£Œ');
      }else{
        markUnsaved();
        showToast('ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ. âš ï¸ ì €ì¥ í•„ìš”');
      }
      renderAdminPanel();renderCalendar();renderEmpTable();
    }catch(err){showToast('âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜')}
  };reader.readAsText(file);event.target.value='';
}

function resetAllData(){
  if(!confirm('ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  if(!confirm('âš ï¸ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •ë§ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  employees=JSON.parse(JSON.stringify(DEFAULT_EMP));customHolidays={};
  localStorage.removeItem(STORAGE_KEY);localStorage.removeItem(HOLIDAY_STORAGE_KEY);
  hasUnsaved=false;document.getElementById('saveFloat').style.display='none';
  renderAdminPanel();renderCalendar();renderEmpTable();showToast('âš ï¸ ì „ì²´ ì´ˆê¸°í™” ì™„ë£Œ');
}

// ===== UTILS =====
function openModal(id){document.getElementById(id).classList.add('show')}
function closeModal(id){document.getElementById(id).classList.remove('show')}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3500)}
function copyToClipboard(text){if(navigator.clipboard){navigator.clipboard.writeText(text).catch(()=>{fallbackCopy(text)})}else{fallbackCopy(text)}}
function fallbackCopy(text){const ta=document.createElement('textarea');ta.value=text;ta.style.position='fixed';ta.style.left='-9999px';document.body.appendChild(ta);ta.select();try{document.execCommand('copy')}catch(e){}document.body.removeChild(ta)}
function toggleSync(){isFirebase=!isFirebase;document.getElementById('syncBtn').innerHTML=isFirebase?'ğŸŸ¢ ì‹¤ì‹œê°„ ë™ê¸°í™”':'ğŸ”´ ì˜¤í”„ë¼ì¸ (ë¡œì»¬)';showToast(isFirebase?'ì‹¤ì‹œê°„ ë™ê¸°í™” ëª¨ë“œ':'ì˜¤í”„ë¼ì¸ ëª¨ë“œ')}

document.querySelectorAll('.modal-overlay').forEach(o=>{
  o.addEventListener('click',function(e){
    if(e.target===this){
      if(this.id==='adminModal'){isAdminMode=false}
      this.classList.remove('show');
    }
  });
});

window.addEventListener('beforeunload',function(e){if(hasUnsaved){e.preventDefault();e.returnValue=''}});

init();
</script>
</body>
</html>
